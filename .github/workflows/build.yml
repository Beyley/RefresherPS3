name: Build PKG

on:
  push:
    branches: [ "master" ]
  pull_request:
    branches: [ "master" ]

jobs:

  build:

    runs-on: macos-14

    steps:
    - name: Install Docker
      run: |
        brew install docker
        brew install colima
        colima start
    
        # For testcontainers to find the Colima socket
        # https://github.com/abiosoft/colima/blob/main/docs/FAQ.md#cannot-connect-to-the-docker-daemon-at-unixvarrundockersock-is-the-docker-daemon-running
        sudo ln -sf $HOME/.colima/default/docker.sock /var/run/docker.sock
      
    - uses: actions/checkout@v3
    - name: Run the build
      run: docker run -v `pwd`:/RefresherPS3 zeldin/ps3dev-docker /RefresherPS3/docker-build-internal.sh
